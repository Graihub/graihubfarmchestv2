--// Grai Hub Fluent Full (UI + Farm + Marines + Hop)

-- üìå Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer
local PlaceID = game.PlaceId

-- üìå Data l∆∞u server hop
local AllIDs = {}
local foundAnything = ""

if isfile and isfile("NotSameServers.json") then
    AllIDs = HttpService:JSONDecode(readfile("NotSameServers.json"))
else
    if writefile then
        writefile("NotSameServers.json", HttpService:JSONEncode(AllIDs))
    end
end

-- üìå UI Grai Hub
local gui = Instance.new("ScreenGui")
gui.Name = "GraiHubUI"
gui.ResetOnSpawn = false
gui.IgnoreGuiInset = true
gui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Main Frame
local mainFrame = Instance.new("Frame", gui)
mainFrame.Size = UDim2.new(0, 420, 0, 200)
mainFrame.Position = UDim2.new(0.5, -210, 0.2, 0)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.BackgroundTransparency = 0.1
mainFrame.Visible = false

Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 14)
local stroke = Instance.new("UIStroke", mainFrame)
stroke.Color = Color3.fromRGB(0, 170, 255)
stroke.Thickness = 2

-- Gradient
local gradient = Instance.new("UIGradient", mainFrame)
gradient.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(30,30,30)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(50,50,50))
}
gradient.Rotation = 45

-- Title
local title = Instance.new("TextLabel", mainFrame)
title.Size = UDim2.new(1, -20, 0, 50)
title.Position = UDim2.new(0, 10, 0, 5)
title.BackgroundTransparency = 1
title.Text = "‚ö° Grai Hub"
title.TextColor3 = Color3.fromRGB(0, 200, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 28
title.TextXAlignment = Enum.TextXAlignment.Left

-- Info Player
local infoLabel = Instance.new("TextLabel", mainFrame)
infoLabel.Size = UDim2.new(1, -20, 0, 40)
infoLabel.Position = UDim2.new(0, 10, 0, 70)
infoLabel.BackgroundTransparency = 1
infoLabel.TextColor3 = Color3.fromRGB(255,255,255)
infoLabel.TextScaled = true
infoLabel.Font = Enum.Font.Gotham
infoLabel.Text = "Loading..."

spawn(function()
	while task.wait(1) do
		pcall(function()
			local level = LocalPlayer.Data.Level.Value
			local beli = LocalPlayer.Data.Beli.Value
			local frags = LocalPlayer.Data.Fragments.Value
			infoLabel.Text = "Lv: " .. level .. " | Beli: " .. beli .. " | Frags: " .. frags
		end)
	end
end)

-- Toggle Button
local toggleButton = Instance.new("TextButton", gui)
toggleButton.Size = UDim2.new(0, 120, 0, 40)
toggleButton.Position = UDim2.new(0, 20, 0, 100)
toggleButton.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
toggleButton.Text = "Open"
toggleButton.TextColor3 = Color3.fromRGB(255,255,255)
toggleButton.TextScaled = true
toggleButton.Font = Enum.Font.GothamBold
Instance.new("UICorner", toggleButton).CornerRadius = UDim.new(0, 10)

local isOpen = false
toggleButton.MouseButton1Click:Connect(function()
	isOpen = not isOpen
	mainFrame.Visible = isOpen
	toggleButton.Text = isOpen and "Close" or "Open"
end)

-- FPS + Ping
local statsLabel = Instance.new("TextLabel", gui)
statsLabel.Size = UDim2.new(0, 220, 0, 40)
statsLabel.Position = UDim2.new(1, -230, 0, 20)
statsLabel.BackgroundTransparency = 0.15
statsLabel.BackgroundColor3 = Color3.fromRGB(25,25,25)
statsLabel.TextColor3 = Color3.fromRGB(0,255,0)
statsLabel.Font = Enum.Font.GothamBold
statsLabel.TextSize = 18
statsLabel.Text = "FPS: 0 | Ping: 0"

Instance.new("UICorner", statsLabel).CornerRadius = UDim.new(0, 10)

RunService.RenderStepped:Connect(function(dt)
	local fps = math.floor(1/dt)
	local ping = game:GetService("Stats").Network.ServerStatsItem["Data Ping"]:GetValueString()
	statsLabel.Text = "FPS: "..fps.." | Ping: "..ping
end)

--------------------------------------------------------
-- Auto Farm Chest + Auto Marines
--------------------------------------------------------

local function getCharacter()
	if not LocalPlayer.Character then
		LocalPlayer.CharacterAdded:Wait()
	end
	LocalPlayer.Character:WaitForChild("HumanoidRootPart")
	return LocalPlayer.Character
end

local function DistanceFromPlrSort(ObjectList: table)
	local RootPart = getCharacter().LowerTorso
	table.sort(ObjectList, function(A,B)
		return (RootPart.Position - A.Position).Magnitude < (RootPart.Position - B.Position).Magnitude
	end)
end

local UncheckedChests, FirstRun = {}, true
local function getChestsSorted()
	if FirstRun then
		FirstRun = false
		for _, Object in pairs(game:GetDescendants()) do
			if Object.Name:find("Chest") and Object.ClassName == "Part" then
				table.insert(UncheckedChests, Object)
			end
		end
	end
	local Chests = {}
	for _, Chest in pairs(UncheckedChests) do
		if Chest:FindFirstChild("TouchInterest") then
			table.insert(Chests, Chest)
		end
	end
	DistanceFromPlrSort(Chests)
	return Chests
end

local function toggleNoclip(Toggle: boolean)
	for _, v in pairs(getCharacter():GetChildren()) do
		if v:IsA("BasePart") then
			v.CanCollide = not Toggle
		end
	end
end

local function Teleport(Goal: CFrame)
	local RootPart = getCharacter().HumanoidRootPart
	toggleNoclip(true)
	RootPart.CFrame = Goal + Vector3.new(0, 3, 0)
	toggleNoclip(false)
end

local function startFarm()
	task.spawn(function()
		while task.wait() do
			local Chests = getChestsSorted()
			if #Chests > 0 then
				Teleport(Chests[1].CFrame)
			end
		end
	end)
end

-- Auto ch·ªçn Marines
task.spawn(function()
	while task.wait(5) do
		pcall(function()
			ReplicatedStorage.Remotes.CommF_:InvokeServer("SetTeam","Marines")
		end)
	end
end)

LocalPlayer.CharacterAdded:Connect(function()
	task.wait(1)
	startFarm()
end)
startFarm()

--------------------------------------------------------
-- üìå Server Hop m·ªói 60s
--------------------------------------------------------

local function Rejoin()
    pcall(function()
        TeleportService:Teleport(PlaceID, LocalPlayer)
    end)
end

local function TPReturner()
    local site
    if foundAnything == "" then
        site = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..PlaceID.."/servers/Public?sortOrder=Asc&limit=100"))
    else
        site = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..PlaceID.."/servers/Public?sortOrder=Asc&limit=100&cursor="..foundAnything))
    end
    if site.nextPageCursor then
        foundAnything = site.nextPageCursor
    end
    for _,v in pairs(site.data) do
        if v.playing < v.maxPlayers then
            local id = tostring(v.id)
            if not table.find(AllIDs,id) then
                table.insert(AllIDs,id)
                if writefile then
                    writefile("NotSameServers.json", HttpService:JSONEncode(AllIDs))
                end
                TeleportService:TeleportToPlaceInstance(PlaceID, id, LocalPlayer)
                task.wait(4)
            end
        end
    end
    Rejoin()
end

task.spawn(function()
    while task.wait(60) do -- ch·ªânh s·ªë gi√¢y hop ·ªü ƒë√¢y
        pcall(TPReturner)
    end
end)

Players.LocalPlayer.OnTeleport:Connect(function(State)
    if State == Enum.TeleportState.Failed then
        Rejoin()
    end
end)

print("‚úÖ Grai Hub Fluent Full Loaded")
